<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Isometric Tap/Swipe Move — Starter</title>
<style>
  html,body{margin:0;height:100%;background:#101114;overscroll-behavior:contain}
  canvas{display:block;width:100vw;height:100vh;touch-action:none}
  .hud{
    position:fixed; left:0; right:0; top:env(safe-area-inset-top);
    display:flex; justify-content:space-between; padding:10px 14px;
    font:14px system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:#fff;
    text-shadow:0 1px 2px rgba(0,0,0,.6); user-select:none; -webkit-user-select:none
  }
  .btns{position:fixed; left:0; right:0; bottom:calc(12px + env(safe-area-inset-bottom));
        display:flex; gap:12px; justify-content:center}
  button{padding:10px 14px; border:0; border-radius:12px; background:#2b2b2b; color:#fff}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="hud">
  <div>Tap near the player <b>or swipe</b> to move one tile</div>
  <div id="pos"></div>
</div>
<div class="btns"><button id="reset">↻ Reset</button></div>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const posEl = document.getElementById('pos');

const GRID = { cols: 10, rows: 10 };
let TILE_W = 64;
let TILE_H = TILE_W/2;
let ORIGIN = { x: 0, y: 0 };

function fit(){
  const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
  cvs.width  = Math.floor(cvs.clientWidth  * dpr);
  cvs.height = Math.floor(cvs.clientHeight * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);

  TILE_W = Math.max(44, Math.min(72, Math.floor(cvs.clientWidth / 9)));
  TILE_H = TILE_W/2;
  ORIGIN.x = cvs.clientWidth/2;
  ORIGIN.y = 80;
}
addEventListener('resize', fit, {passive:true});
fit();

function gridToScreen(i,j){
  const x = (i - j) * (TILE_W/2);
  const y = (i + j) * (TILE_H/2);
  return { x: ORIGIN.x + x, y: ORIGIN.y + y };
}
function screenToGrid(x,y){
  const sx = x - ORIGIN.x;
  const sy = y - ORIGIN.y;
  const i = (sx/(TILE_W/2) + sy/(TILE_H/2)) / 2;
  const j = (sy/(TILE_H/2) - sx/(TILE_W/2)) / 2;
  return { i, j };
}

const player = { i:4, j:4, ti:4, tj:4, t:1, speed:8/1000 };
updateHud();

function reset(){
  player.i = player.ti = Math.floor(GRID.cols/2);
  player.j = player.tj = Math.floor(GRID.rows/2);
  player.t = 1;
  updateHud();
}
document.getElementById('reset').onclick = reset;

// --- Input: tap or swipe ---
let start = null;
const SWIPE_THRESHOLD = 28;

addEventListener('pointerdown', (e)=>{
  const r = cvs.getBoundingClientRect();
  start = { x: e.clientX - r.left, y: e.clientY - r.top, time: performance.now() };
}, {passive:true});

addEventListener('pointerup', (e)=>{
  if (player.t < 1) return;
  const r = cvs.getBoundingClientRect();
  const end = { x: e.clientX - r.left, y: e.clientY - r.top };
  if (!start){ return; }
  const dx = end.x - start.x;
  const dy = end.y - start.y;
  const dist = Math.hypot(dx, dy);

  if (dist >= SWIPE_THRESHOLD){
    const u = dx + dy;
    const v = dy - dx;
    if (Math.abs(u) > Math.abs(v)){
      step(sign(u), 0);
    } else {
      step(0, sign(v));
    }
  } else {
    const g = screenToGrid(end.x, end.y);
    const di = g.i - player.i;
    const dj = g.j - player.j;
    if (Math.abs(di) > Math.abs(dj)) step(sign(di), 0);
    else step(0, sign(dj));
  }
  start = null;
}, {passive:true});

function sign(v){ return v>0 ? 1 : v<0 ? -1 : 0; }

function step(stepI, stepJ){
  const ni = clamp(player.i + stepI, 0, GRID.cols-1);
  const nj = clamp(player.j + stepJ, 0, GRID.rows-1);
  if (ni !== player.i || nj !== player.j){
    player.ti = ni; player.tj = nj; player.t = 0;
  }
}
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

function drawTile(i,j,fill){
  const {x,y} = gridToScreen(i,j);
  ctx.beginPath();
  ctx.moveTo(x, y - TILE_H/2);
  ctx.lineTo(x + TILE_W/2, y);
  ctx.lineTo(x, y + TILE_H/2);
  ctx.lineTo(x - TILE_W/2, y);
  ctx.closePath();
  ctx.fillStyle = fill; ctx.fill();
  ctx.strokeStyle = 'rgba(0,0,0,.35)'; ctx.stroke();
}
function drawPlayer(x,y){
  const h = TILE_H;
  ctx.beginPath();
  ctx.moveTo(x, y - TILE_H/2 - h);
  ctx.lineTo(x + TILE_W/2, y - h);
  ctx.lineTo(x, y + TILE_H/2 - h);
  ctx.lineTo(x - TILE_W/2, y - h);
  ctx.closePath();
  ctx.fillStyle = '#4cc9f0'; ctx.fill();

  ctx.beginPath();
  ctx.moveTo(x, y + TILE_H/2 - h);
  ctx.lineTo(x + TILE_W/2, y - h);
  ctx.lineTo(x + TILE_W/2, y);
  ctx.lineTo(x, y + TILE_H/2);
  ctx.closePath();
  ctx.fillStyle = '#1f7fa0'; ctx.fill();

  ctx.beginPath();
  ctx.moveTo(x, y + TILE_H/2 - h);
  ctx.lineTo(x - TILE_W/2, y - h);
  ctx.lineTo(x - TILE_W/2, y);
  ctx.lineTo(x, y + TILE_H/2);
  ctx.closePath();
  ctx.fillStyle = '#2a9bc0'; ctx.fill();
}

let last = 0;
function loop(t=0){
  requestAnimationFrame(loop);
  const dt = Math.min(33, t - last || 16.7); last = t;
  if (player.t < 1){
    const dist = Math.hypot(player.ti - player.i, player.tj - player.j);
    const k = (player.speed * dt) / Math.max(0.0001, dist);
    player.t = Math.min(1, player.t + k);
    if (player.t === 1){ player.i = player.ti; player.j = player.tj; updateHud(); }
  }
  render();
}
loop();

function render(){
  ctx.clearRect(0,0,cvs.clientWidth,cvs.clientHeight);
  ctx.fillStyle = '#101114'; ctx.fillRect(0,0,cvs.clientWidth,cvs.clientHeight);
  for (let j=0;j<GRID.rows;j++){
    for (let i=0;i<GRID.cols;i++){
      drawTile(i,j, ((i+j)&1)===0 ? '#1a1c20':'#17191c');
    }
  }
  const pi = lerp(player.i, player.ti, player.t);
  const pj = lerp(player.j, player.tj, player.t);
  const pxy = gridToScreen(pi, pj);
  ctx.globalAlpha = 0.25;
  drawTile(player.ti, player.tj, '#4cc9f0');
  ctx.globalAlpha = 1;
  drawPlayer(pxy.x, pxy.y);
}
function lerp(a,b,t){ return a + (b - a) * t; }
function updateHud(){ posEl.textContent = `(${player.i}, ${player.j})`; }

let lastTouch=0;
addEventListener('touchend', e=>{
  const now = Date.now();
  if (now-lastTouch<300) e.preventDefault();
  lastTouch = now;
}, {passive:false});
</script>
</body>
</html>